var{isArray:a}=Array,{keys:b}=Object;(function($){var A='tdac',c={DATA:'DATA',SYMBOL:'SYMBOL',ACTION:'ACTION',ICON:'ICON'},d=[{vfTitle:'⌴',vfCode:'space',vfType:c.SYMBOL,vfAcutalField:'space',vfActualFieldTitle:'Dấu cách',value:'&nbsp;'},{vfTitle:'↩',vfCode:'newline',vfType:c.SYMBOL,vfAcutalField:'newline',vfActualFieldTitle:'NewLine',value:'<br/>'},{vfTitle:'-',vfCode:'minus',vfType:c.SYMBOL,vfAcutalField:'minus',vfActualFieldTitle:'Dấu trừ',value:'&hyphen;'},{vfTitle:'|',vfCode:'vertical',vfType:c.SYMBOL,vfAcutalField:'vertical',vfActualFieldTitle:'Dấu dọc',value:'|'},{vfTitle:',',vfCode:'comma',vfType:c.SYMBOL,vfAcutalField:'comma',vfActualFieldTitle:'Dấu phẩy',value:','},{vfTitle:'.',vfCode:'dot',vfType:c.SYMBOL,vfAcutalField:'dot',vfActualFieldTitle:'Dấu chấm',value:'.'},{vfTitle:';',vfCode:'semicolon',vfType:c.SYMBOL,vfAcutalField:'semicolon',vfActualFieldTitle:'Chấm phẩy',value:';'},{vfTitle:'[',vfCode:'openBracket',vfType:c.SYMBOL,vfAcutalField:'openBracket',vfActualFieldTitle:'Mở ngoặc vuông',value:'['},{vfTitle:']',vfCode:'closeBracket',vfType:c.SYMBOL,vfAcutalField:'closeBracket',vfActualFieldTitle:'Đóng ngoặc vuông',value:']'},{vfTitle:'(',vfCode:'openRoundBracket',vfType:c.SYMBOL,vfAcutalField:'openRoundBracket',vfActualFieldTitle:'Mở ngoặc tròn',value:'('},{vfTitle:')',vfCode:'closeRoundBracket',vfType:c.SYMBOL,vfAcutalField:'closeRoundBracket',vfActualFieldTitle:'Đóng hoặc tròn',value:')'}],f=(_A,_b={})=>_A.replace(/\{\{(.*?)\}\}/g,(E,_B)=>{const _C=_b[_B];return (_C!==void 0&&_C!==null)?_C:E}),g=aA=>`${aA}`.replace(/[&<>"'`=\/]/g,s=>{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'}[s]),h=aB=>{try {return JSON.parse(aB)} catch {return null}};function _(B={},C='',_c={}){for(const _a of b(B)){var D=C?`${C}.${_a}`:_a;typeof B[_a]=='object'&&B[_a]!==null?_(B[_a],D,_c):_c[D]=B[_a]}return _c}$.fn.flexiTable=function({columns:aD=[],templates:aE=[],data:_d=[],height:_e=300,fixed:F=!1,onCta:aC}){var G=$(this),i=[...aE,...d].reduce((aI,aJ)=>{aI[aJ.vfCode]=aJ;return aI},{}),j=(aK={},aL,aM,_D={})=>{const _E=[];for(const aN of aL.fieldCodes){const aO=_D[aN];if(aO){if(aO.vfType==c.SYMBOL){_E.push(aO?.value||'');continue}if(aO.vfType==c.ACTION){_E.push(`<span class="btn btn-${aO.vfAcutalField}" onClick="${H}('${aO.vfCode}', ${aM})">${aO?.vfTitle||''}</span>`);continue}if(aO.vfType==c.ICON){_E.push(`<img class="icon" src="${aO.value}"/>`);continue}if(aO.vfRenderFunc){_E.push(aO.vfRenderFunc(aK,aO,aM,H));continue}const aP=aK[aO.vfAcutalField],aQ=_(aK);if(a(aP)){_E.push(aO.templateShow?aP.map(aS=>f(aO.templateShow,{$item:g(aS)})).join(''):aP.join(', '));continue}let aR=aQ[aO?.vfAcutalField||''];aO?.enum&&b(aO.enum).length>0&&(aR=aO.enum[aR]||aR,aR=g(aR));aO?.templateShow&&(aR=f(aO?.templateShow,{value:g(aR)}));_E.push(aR)}}return _E.join('')};G.addClass('wrapper-table').addClass('custom-scroll');F&&(G.addClass('fixed'),G.css({height:`${_e}px`}));var H=`${A}${~~Math.random()*1e6}`;window[H]=(aF,aG)=>{if(aC){var aH=_d[aG];aC(aF,aH,aG)}};function k(){var aT=$('<table class="dynamic-table"></table>');G.append(aT);this.table=aT;this.data=_d;this.columns=aD;this.templates=aE}k.prototype.drawHeader=function(){var aU=$('<thead></thead>'),aV=$('<tr></tr>');for(const aX of this.columns){var aW=$(`<th> ${aX.title} </th>`);aV.append(aW)}aU.append(aV);this.table.append(aU);return this};k.prototype.drawBody=function(){var aY=$('<tbody></tbody>');for(const[bC,bD] of this.data.entries()){var aZ=$('<tr></tr>');for(const bE of this.columns){var bA=$(`<td></td>`),bB=$('<div class="td-line"></div>');bB.html(j(bD,bE,bC,i));bA.append(bB);aZ.append(bA)}aY.append(aZ)}this.table.append(aY);return this};k.prototype.setTemplate=function(bF){this.templates=bF;return this};k.prototype.setColumns=function(bG){this.columns=bG;return this};k.prototype.setData=function(bH){this.data=bH;return this};k.prototype.reload=function(){this.table.empty();this.drawHeader();this.drawBody();return this};var l=new k();l.drawHeader();l.drawBody();return l};$.fn.flexiTableEdit=function({columns:bI=[],vfFields:bJ=[],actions:bK=[],icons:bL=[],height:bM=390}){var _f=$(this),_g=$('<div class="grid-col-2"></div>');_f.addClass('dynamic-table-edit').addClass('box').addClass('box-grid');_f.css({height:`${bM}px`});_f.append(_g);_g.append(`
      <div class="edit-columns">
        <div class="justify-content-space-between">
          <h5> Columns </h5>
          <div>
            <button class="btn-plus" :disabled="disabled" @click="onAddColumn">✚</button>
          </div>
        </div>
        <hr style="margin: 5px 0"/>
        <ul class="dragArea list-group custom-scroll list-columns">
        </ul>
      </div>

      <div class="edit-columns">
        <h5>Fields</h5>
        <hr style="margin: 5px 0"/>
          <ul class="list-field custom-scroll list-fields">
            <!--
              <li v-for="field in listFields" :key="field.field">
                <div class="label">{{ field.title }}:</div>
                <div class="item" draggable="true" @dragstart="e => onDragstart(e, vfield)" v-for="vfield in field.variants" :key="vfield.vfCode"> {{ vfield.vfTitle }} </div>
              </li>
            -->
          </ul>
      </div>

      <div class="edit-columns etc-field custom-scroll">
        <div>
          <h5>Separator</h5>
          <hr style="margin: 5px 0"/>
          <ul class="list-field-symbol list-separators">
            <!--
              <li v-for="field in symbols" :key="field.vfAcutalField">
                <div class="item" draggable="true" @dragstart="e => onDragstart(e, field)"> {{ field.vfTitle }} </div>
              </li>
            -->
          </ul>
        </div>

        <div style="margin-top: 10px">
          <h5>Actions</h5>
          <hr style="margin: 5px 0"/>
          <ul class="list-field-symbol list-actions">
            <!--
              <li v-for="field in actions" :key="field.vfAcutalField">
                <div class="item btn" draggable="true" @dragstart="e => onDragstart(e, field)"> {{ field.vfTitle }} </div>
              </li>
            -->
          </ul>
        </div>
        
        <div style="margin-top: 10px">
          <h5>Icons</h5>
          <hr style="margin: 5px 0"/>
          <ul class="list-field-symbol list-icons">
            <!--
              <li v-for="field in icons" :key="field.vfAcutalField">
                <img :src="field.value" class="icon" draggable="true" @dragstart="e => onDragstart(e, field)"/>
              </li>
            -->
          </ul>
        </div>
      </div>
    `);function _h(){this.columns=bI;this.vfFields=bJ;this.disabled=!1;this.mapFunction={};this.currentRow=-1;this.btnPlus=_g.find('.btn-plus');this.listColumns=_g.find('.list-columns');this.listFields=_g.find('.list-fields');this.listSeparator=_g.find('.list-separators');this.listActions=_g.find('.list-actions');this.listIcons=_g.find('.list-icons');for(const bP of d){var bN=$('<li></li>'),bO=$(`<div class="item" draggable="true"> ${bP.vfTitle} </div>`);bN.append(bO);this.listSeparator.append(bN);bO.on('dragstart',e=>this.onDragstart(e,bP))}for(const bQ of bK){var bN=$('<li></li>'),bO=$(`<div class="item btn" draggable="true"> ${bQ.vfTitle} </div>`);bN.append(bO);this.listActions.append(bN);bO.on('dragstart',e=>this.onDragstart(e,bQ))}for(const bR of bL){var bN=$('<li></li>'),bO=$(`<img src="${bR.value}" class="icon" draggable="true" />`);bN.append(bO);this.listIcons.append(bN);bO.on('dragstart',e=>this.onDragstart(e,bR))}this.mapFieldInfo=[...bJ,...bL,...bK,...d].reduce((bS,bT)=>{bS[bT.vfCode]=bT;return bS},{});this.drawVfFields();this.drawColumns();this.btnPlus.click(()=>this.addColumn());return this};_h.prototype.drawVfFields=function(){var bU={},bV=[];for(const bZ of this.vfFields){var bW=bZ?.vfAcutalField||'';bU[bW]==void 0?(bV.push({title:bZ.vfActualFieldTitle||'',field:bW,variants:[bZ]}),bU[bW]=bV.length-1):(bV[bU[bW]].variants.push(bZ))}for(const cA of bV){var bX=$('<li></li>'),bY=$(`<div class="label"> ${cA.title}:</div>`);bX.append(bY);for(const cB of cA.variants){var _F=$(`<div class="item" draggable="true"> ${cB.vfTitle} </div>`);bX.append(_F);_F.on('dragstart',e=>this.onDragstart(e,cB))}this.listFields.append(bX)}};_h.prototype.drawColumns=function(){var cC=this;for(const cD of cC.columns)cC._addRow(cD)};_h.prototype.addEventListener=function(cE,cF){this.mapFunction[cE]==void 0&&(this.mapFunction[cE]=[]);this.mapFunction[cE].push(cF)};_h.prototype.emit=function(cG){var cH=this.mapFunction[cG];if(cH&&cH.length>0)for(const cI of cH)cI(this.columns)};_h.prototype._addRow=function(cJ){var cK=this,q=$(`
        <li class="list-group-item">
          <div class="label align-items-center drop-zone">
            <div class="align-items-center">
              <span class="handle">☰</span>
              <div class="inline-block popper-wrapper">
                <button class="btn-more btn-popover">⋯</button>
                <div class="popover-action popover-content">
                  <div>
                    <button class="btn-more btn-align-left">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMTcgMTBIM00yMSA2SDNNMjEgMTRIM00xNyAxOEgzIi8+PC9zdmc+" />
                    </button>
                    <button class="btn-more btn-align-center">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiI+PHBhdGggZD0iTTEyIDI4aDcyYTQgNCAwIDAgMCAwLThIMTJhNCA0IDAgMCAwIDAgOHptOCA4YTQgNCAwIDAgMCAwIDhoNTZhNCA0IDAgMCAwIDAtOEgyMHptNjQgMTZIMTJhNCA0IDAgMCAwIDAgOGg3MmE0IDQgMCAwIDAgMC04em0tOCAxNkgyMGE0IDQgMCAwIDAgMCA4aDU2YTQgNCAwIDAgMCAwLTh6Ii8+PC9zdmc+" />
                    </button>
                    <button class="btn-more btn-align-right">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiI+PHBhdGggZD0iTTg4IDI0YTQgNCAwIDAgMC00LTRIMTJhNCA0IDAgMCAwIDAgOGg3MmE0IDQgMCAwIDAgNC00em0wIDE2YTQgNCAwIDAgMC00LTRIMjhhNCA0IDAgMCAwIDAgOGg1NmE0IDQgMCAwIDAgNC00ek04IDU2YTQgNCAwIDAgMCA0IDRoNzJhNCA0IDAgMCAwIDAtOEgxMmE0IDQgMCAwIDAtNCA0em0xNiAxNmE0IDQgMCAwIDAgNCA0aDU2YTQgNCAwIDAgMCAwLThIMjhhNCA0IDAgMCAwLTQgNHoiLz48L3N2Zz4=" />
                    </button>
                  </div>
                  <div style="margin-top: 4px">
                    <button class="btn-more btn-valign-top">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNOCAxMWgzdjEwaDJWMTFoM2wtNC00LTQgNHpNNCAzdjJoMTZWM0g0eiIvPjwvc3ZnPg==" />
                    </button>
                    <button class="btn-more btn-valign-middle">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNOCAxOWgzdjRoMnYtNGgzbC00LTQtNCA0em04LTE0aC0zVjFoLTJ2NEg4bDQgNCA0LTR6TTQgMTF2MmgxNnYtMkg0eiIvPjwvc3ZnPg==" />
                    </button>
                    <button class="btn-more btn-valign-bottom">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTYgMTNoLTNWM2gtMnYxMEg4bDQgNCA0LTR6TTQgMTl2MmgxNnYtMkg0eiIvPjwvc3ZnPg==" />
                    </button>
                  </div>
                  <div style="margin-top: 4px" class="div-input">
                    <label class="label">width:</label> <input type="text" v-model="element.width" placeholder="# px | %"/>
                  </div>
                  <div style="margin-top: 4px" class="div-input">
                    <label class="label">min-width:</label> <input type="text" v-model="element.minWidth" placeholder="# px | %"/>
                  </div>
                  <div style="margin-top: 4px" class="div-input">
                    <label class="label">max-width:</label> <input type="text" v-model="element.maxWidth" placeholder="# px | %"/>
                  </div>
                  <div class="popper-arrow"></div>
                </div>
              </div>
              
              <input class="input-title" type="text" placeholder="Column name"/>
            </div>
            <ul class="list-selected-field">
              <!--
              <li v-for="vfCode in element.fieldCodes" :key="vfCode">
                <img v-if="mapFieldInfo[vfCode]?.vfType === VfType.ICON" class="icon-selected":src="mapFieldInfo[vfCode]?.value" />
                <span v-else>{{ mapFieldInfo[vfCode]?.vfTitle }}</span>
              </li>
              <li class="no-data">Kéo field vào đây</li>
              -->
            </ul>
          </div>
          <div>
            <button class="btn btn-close" @click.stop="closeIndex(index)" :disabled="disabled">
              ✘
            </button>
          </div>
        </li>
      `),cL=q.find('.drop-zone'),cM=q.find('.input-title'),cN=q.find('.list-selected-field'),cO=q.find('.btn-close'),_G=q.find('.btn-popover'),_H=q.find('.popover-content'),I=q.find('button.btn-align-left'),J=q.find('button.btn-align-center'),K=q.find('button.btn-align-right'),L=q.find('button.btn-valign-top'),m=q.find('button.btn-valign-middle'),n=q.find('button.btn-valign-bottom'),o=cW=>{const cX=cK.mapFieldInfo[cW];if(cX)return cX.vfType==c.ICON?`<img class="icon-selected" src="${cX.value}" />`:`<span>${cX.vfTitle}</span>`;return''};cK.listColumns.append(q);_G.webuiPopover({url:_H,trigger:'click',placement:'right'});_H.click(function(e){e.preventDefault();return!1});switch(cJ.align||'left') {case 'left':I.addClass('active');break;case 'center':J.addClass('active');break;case 'right':K.addClass('active');break}switch(cJ.vAlign||'top') {case 'top':L.addClass('active');break;case 'middle':m.addClass('active');break;case 'bottom':n.addClass('active');break}_G.click(function(){var cP=$(this);cK.currentRow=cK.listColumns.find('li.list-group-item').index(cP.parent().parent().parent().parent())});I.click(function(){var cQ=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].align='left',cQ.parent().find('.active').removeClass('active'),cQ.addClass('active'),cK.emit('change'))});J.click(function(){var cR=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].align='center',cR.parent().find('.active').removeClass('active'),cR.addClass('active'),cK.emit('change'))});K.click(function(){var cS=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].align='right',cS.parent().find('.active').removeClass('active'),cS.addClass('active'),cK.emit('change'))});L.click(function(){var cT=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].vAlign='top',cT.parent().find('.active').removeClass('active'),cT.addClass('active'),cK.emit('change'))});m.click(function(){var cU=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].vAlign='middle',cU.parent().find('.active').removeClass('active'),cU.addClass('active'),cK.emit('change'))});n.click(function(){var cV=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].vAlign='bottom',cV.parent().find('.active').removeClass('active'),cV.addClass('active'),cK.emit('change'))});cM.val(cJ.title);if(cJ.fieldCodes.length>0){cN.empty();for(const cY of cJ.fieldCodes){var p=o(cY);p&&cN.append(`<li>${p}</li>`)}}else cN.append(`<li class="no-data">Kéo field vào đây</li>`);cL.on('drop',function(e){if(cK.disabled)return!1;e.preventDefault();var cZ=$(this),dA=h(e.originalEvent.dataTransfer.getData('text'));cZ.parent().removeClass('hover');if(dA?.vfCode){var dB=cZ.parent(),dC=cK.listColumns.find('li.list-group-item').index(dB),dD=cZ.find('.list-selected-field'),dE=o(dA.vfCode);cK.columns[dC].fieldCodes.push(dA.vfCode);dD.find('li.no-data').remove();dE&&dD.append(`<li>${dE}</li>`);cK.emit('change')}});cL.on('dragover',function(e){if(cK.disabled)return!1;e.preventDefault();$(this).parent().addClass('hover')});cL.on('dragleave',function(){$(this).parent().removeClass('hover')});cM.change(function(){var dF=$(this),dG=cK.listColumns.find('li.list-group-item').index(dF.parent().parent().parent());cK.columns[dG].title=dF.val();cK.emit('change')});cO.click(function(){var dH=$(this),dI=cK.listColumns.find('li.list-group-item').index(dH.parent().parent());cK.columns[dI].fieldCodes.length>0?(cK.columns[dI].fieldCodes.length=0,_f.find('.list-selected-field').empty().append(`<li class="no-data">Kéo field vào đây</li>`)):(cK.columns.splice(dI,1),cK.listColumns.find('li.list-group-item').eq(dI).remove());this.emit('change')})};_h.prototype.addColumn=function(){var dJ={title:'',fieldCodes:[]};this.columns.push(dJ);this.emit('change');this._addRow(dJ)};_h.prototype.onDragstart=function(e,dK){e.originalEvent.dataTransfer.setData('text',JSON.stringify(dK))};return new _h()}})(jQuery);
