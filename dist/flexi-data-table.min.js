var{isArray:a}=Array,{keys:b}=Object;(function($){var A='tdac',c={DATA:'DATA',SYMBOL:'SYMBOL',ACTION:'ACTION',ICON:'ICON'},d=[{vfTitle:'⌴',vfCode:'space',vfType:c.SYMBOL,vfAcutalField:'space',vfActualFieldTitle:'Dấu cách',value:'&nbsp;'},{vfTitle:'↩',vfCode:'newline',vfType:c.SYMBOL,vfAcutalField:'newline',vfActualFieldTitle:'NewLine',value:'<br/>'},{vfTitle:'-',vfCode:'minus',vfType:c.SYMBOL,vfAcutalField:'minus',vfActualFieldTitle:'Dấu trừ',value:'&nbsp;&minus;&nbsp;'},{vfTitle:'|',vfCode:'vertical',vfType:c.SYMBOL,vfAcutalField:'vertical',vfActualFieldTitle:'Dấu dọc',value:'&nbsp;|&nbsp;'},{vfTitle:',',vfCode:'comma',vfType:c.SYMBOL,vfAcutalField:'comma',vfActualFieldTitle:'Dấu phẩy',value:',&nbsp;'},{vfTitle:'.',vfCode:'dot',vfType:c.SYMBOL,vfAcutalField:'dot',vfActualFieldTitle:'Dấu chấm',value:',&nbsp;'},{vfTitle:';',vfCode:'semicolon',vfType:c.SYMBOL,vfAcutalField:'semicolon',vfActualFieldTitle:'Chấm phẩy',value:';&nbsp;'}],f=(_A,_b={})=>_A.replace(/\{\{(.*?)\}\}/g,(E,_B)=>{const _C=_b[_B];return (_C!==void 0&&_C!==null)?_C:E}),g=aA=>`${aA}`.replace(/[&<>"'`=\/]/g,s=>{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'}[s]);function _(B={},C='',_c={}){for(const _a of b(B)){var D=C?`${C}.${_a}`:_a;typeof B[_a]=='object'&&B[_a]!==null?_(B[_a],D,_c):_c[D]=B[_a]}return _c}$.fn.flexiTable=function({columns:aC=[],templates:aD=[],data:_d=[],height:_e=300,fixed:F=!1,onCta:aB}){var G=$(this),i=[...aD,...d].reduce((aH,aI)=>{aH[aI.vfCode]=aI;return aH},{}),j=(aJ={},aK,aL,_D={})=>{const _E=[];for(const aM of aK.fieldCodes){const aN=_D[aM];if(aN){if(aN.vfType==c.SYMBOL){_E.push(aN?.value||'');continue}if(aN.vfType==c.ACTION){_E.push(`<span class="btn btn-${aN.vfAcutalField}" onClick="${h}('${aN.vfCode}', ${aL})">${aN?.vfTitle||''}</span>`);continue}if(aN.vfType==c.ICON){_E.push(`<img class="icon" src="${aN.value}"/>`);continue}if(aN.vfRenderFunc){_E.push(aN.vfRenderFunc(aJ,aN,aL,h));continue}const aO=aJ[aN.vfAcutalField],aP=_(aJ);if(a(aO)){_E.push(aN.templateShow?aO.map(aR=>f(aN.templateShow,{$item:g(aR)})).join(''):aO.join(', '));continue}let aQ=aP[aN?.vfAcutalField||''];aN?.enum&&b(aN.enum).length>0&&(aQ=aN.enum[aQ]||aQ,aQ=g(aQ));aN?.templateShow&&(aQ=f(aN?.templateShow,{value:g(aQ)}));_E.push(aQ)}}return _E.join('')};G.addClass('wrapper-table').addClass('custom-scroll');F&&(G.addClass('fixed'),G.css({height:`${_e}px`}));var h=`${A}${~~Math.random()*1e6}`;window[h]=(aE,aF)=>{if(aB){var aG=_d[aF];aB(aE,aG,aF)}};function k(){var aS=$('<table class="dynamic-table"></table>');G.append(aS);this.table=aS;this.data=_d;this.columns=aC;this.templates=aD}k.prototype.drawHeader=function(){var aT=$('<thead></thead>'),aU=$('<tr></tr>');for(const aW of this.columns){var aV=$(`<th> ${aW.title} </th>`);aU.append(aV)}aT.append(aU);this.table.append(aT);return this};k.prototype.drawBody=function(){var aX=$('<tbody></tbody>');for(const[bB,bC] of this.data.entries()){var aY=$('<tr></tr>');for(const bD of this.columns){var aZ=$(`<td></td>`),bA=$('<div class="td-line"></div>');bA.html(j(bC,bD,bB,i));aZ.append(bA);aY.append(aZ)}aX.append(aY)}this.table.append(aX);return this};k.prototype.setTemplate=function(bE){this.templates=bE;return this};k.prototype.setColumns=function(bF){this.columns=bF;return this};k.prototype.setData=function(bG){this.data=bG;return this};k.prototype.reload=function(){this.table.empty();this.drawHeader();this.drawBody();return this};var l=new k();l.drawHeader();l.drawBody();return l};$.fn.flexiTableEdit=function({columns:bH=[],vfFields:bI=[],actions:bJ=[],icons:bK=[],height:bL=390}){var _f=$(this),_g=$('<div class="grid-col-2"></div>');_f.addClass('dynamic-table-edit').addClass('box').addClass('box-grid');_f.css({height:`${bL}px`});_f.append(_g);_g.append(`
      <div class="edit-columns">
        <div class="justify-content-space-between">
          <h5> Columns </h5>
          <div>
            <button class="btn-plus" :disabled="disabled" @click="onAddColumn">✚</button>
          </div>
        </div>
        <hr style="margin: 5px 0"/>
        <ul class="dragArea list-group custom-scroll list-columns">
        </ul>
      </div>

      <div class="edit-columns">
        <h5>Fields</h5>
        <hr style="margin: 5px 0"/>
          <ul class="list-field custom-scroll list-fields">
            <!--
              <li v-for="field in listFields" :key="field.field">
                <div class="label">{{ field.title }}:</div>
                <div class="item" draggable="true" @dragstart="e => onDragstart(e, vfield)" v-for="vfield in field.variants" :key="vfield.vfCode"> {{ vfield.vfTitle }} </div>
              </li>
            -->
          </ul>
      </div>

      <div class="edit-columns etc-field custom-scroll">
        <div>
          <h5>Separator</h5>
          <hr style="margin: 5px 0"/>
          <ul class="list-field-symbol list-separators">
            <!--
              <li v-for="field in symbols" :key="field.vfAcutalField">
                <div class="item" draggable="true" @dragstart="e => onDragstart(e, field)"> {{ field.vfTitle }} </div>
              </li>
            -->
          </ul>
        </div>

        <div style="margin-top: 10px">
          <h5>Actions</h5>
          <hr style="margin: 5px 0"/>
          <ul class="list-field-symbol list-actions">
            <!--
              <li v-for="field in actions" :key="field.vfAcutalField">
                <div class="item btn" draggable="true" @dragstart="e => onDragstart(e, field)"> {{ field.vfTitle }} </div>
              </li>
            -->
          </ul>
        </div>
        
        <div style="margin-top: 10px">
          <h5>Icons</h5>
          <hr style="margin: 5px 0"/>
          <ul class="list-field-symbol list-icons">
            <!--
              <li v-for="field in icons" :key="field.vfAcutalField">
                <img :src="field.value" class="icon" draggable="true" @dragstart="e => onDragstart(e, field)"/>
              </li>
            -->
          </ul>
        </div>
      </div>
    `);function H(){this.columns=bH;this.vfFields=bI;this.btnPlus=_g.find('.btn-plus');this.listColumns=_g.find('.list-columns');this.listFields=_g.find('.list-fields');this.listSeparator=_g.find('.list-separators');this.listActions=_g.find('.list-actions');this.listIcons=_g.find('.list-icons');for(const bO of d){var bM=$('<li></li>'),bN=$(`<div class="item" draggable="true"> ${bO.vfTitle} </div>`);bM.append(bN);this.listSeparator.append(bM);bN.on('dragstart',e=>this.onDragstart(e,bO))}for(const bP of bJ){var bM=$('<li></li>'),bN=$(`<div class="item btn" draggable="true"> ${bP.vfTitle} </div>`);bM.append(bN);this.listActions.append(bM);bN.on('dragstart',e=>this.onDragstart(e,bP))}for(const bQ of bK){var bM=$('<li></li>'),bN=$(`<img src="${bQ.value}" class="icon" draggable="true" />`);bM.append(bN);this.listIcons.append(bM);bN.on('dragstart',e=>this.onDragstart(e,bQ))}this.drawVfFields();this.btnPlus.click(()=>this.addColumn())};H.prototype.drawVfFields=function(){var bR={},bS=[];for(const bW of this.vfFields){var bT=bW?.vfAcutalField||'';bR[bT]==void 0?(bS.push({title:bW.vfActualFieldTitle||'',field:bT,variants:[bW]}),bR[bT]=bS.length-1):(bS[bR[bT]].variants.push(bW))}for(const bX of bS){var bU=$('<li></li>'),bV=$(`<div class="label"> ${bX.title}:</div>`);bU.append(bV);for(const bY of bX.variants){var _F=$(`<div class="item" draggable="true"> ${bY.vfTitle} </div>`);bU.append(_F);_F.on('dragstart',e=>this.onDragstart(e,bY))}this.listFields.append(bU)}};H.prototype.addColumn=function(){};H.prototype.onDragstart=function(e,bZ){e.originalEvent.dataTransfer.setData('text',JSON.stringify(bZ))};return new H()}})(jQuery);
