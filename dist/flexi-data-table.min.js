var{isArray:a}=Array,{keys:b}=Object;(function($){var A='tdac',c={DATA:'DATA',SYMBOL:'SYMBOL',ACTION:'ACTION',ICON:'ICON'},d=[{vfTitle:'⌴',vfCode:'space',vfType:c.SYMBOL,vfAcutalField:'space',vfActualFieldTitle:'Dấu cách',value:'&nbsp;'},{vfTitle:'↩',vfCode:'newline',vfType:c.SYMBOL,vfAcutalField:'newline',vfActualFieldTitle:'NewLine',value:'<br/>'},{vfTitle:'-',vfCode:'minus',vfType:c.SYMBOL,vfAcutalField:'minus',vfActualFieldTitle:'Dấu trừ',value:'&hyphen;'},{vfTitle:'|',vfCode:'vertical',vfType:c.SYMBOL,vfAcutalField:'vertical',vfActualFieldTitle:'Dấu dọc',value:'|'},{vfTitle:',',vfCode:'comma',vfType:c.SYMBOL,vfAcutalField:'comma',vfActualFieldTitle:'Dấu phẩy',value:','},{vfTitle:'.',vfCode:'dot',vfType:c.SYMBOL,vfAcutalField:'dot',vfActualFieldTitle:'Dấu chấm',value:'.'},{vfTitle:';',vfCode:'semicolon',vfType:c.SYMBOL,vfAcutalField:'semicolon',vfActualFieldTitle:'Chấm phẩy',value:';'},{vfTitle:'[',vfCode:'openBracket',vfType:c.SYMBOL,vfAcutalField:'openBracket',vfActualFieldTitle:'Mở ngoặc vuông',value:'['},{vfTitle:']',vfCode:'closeBracket',vfType:c.SYMBOL,vfAcutalField:'closeBracket',vfActualFieldTitle:'Đóng ngoặc vuông',value:']'},{vfTitle:'(',vfCode:'openRoundBracket',vfType:c.SYMBOL,vfAcutalField:'openRoundBracket',vfActualFieldTitle:'Mở ngoặc tròn',value:'('},{vfTitle:')',vfCode:'closeRoundBracket',vfType:c.SYMBOL,vfAcutalField:'closeRoundBracket',vfActualFieldTitle:'Đóng hoặc tròn',value:')'}],f=(_A,_b={})=>_A.replace(/\{\{(.*?)\}\}/g,(E,_B)=>{const _C=_b[_B];return (_C!==void 0&&_C!==null)?_C:E}),g=aA=>`${aA}`.replace(/[&<>"'`=\/]/g,s=>{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'}[s]),h=aB=>{try {return JSON.parse(aB)} catch {return null}};function _(B={},C='',_c={}){for(const _a of b(B)){var D=C?`${C}.${_a}`:_a;typeof B[_a]=='object'&&B[_a]!==null?_(B[_a],D,_c):_c[D]=B[_a]}return _c}$.fn.flexiTable=function({columns:aD=[],templates:aE=[],data:_d=[],height:_e=300,fixed:F=!1,onCta:aC}){var G=$(this),i=[...aE,...d].reduce((aI,aJ)=>{aI[aJ.vfCode]=aJ;return aI},{}),j=(aK={},aL,aM,_D={})=>{const _E=[];for(const aN of aL.fieldCodes){const aO=_D[aN];if(aO){if(aO.vfType==c.SYMBOL){_E.push(aO?.value||'');continue}if(aO.vfType==c.ACTION){_E.push(`<span class="btn btn-${aO.vfAcutalField}" onClick="${H}('${aO.vfCode}', ${aM})">${aO?.vfTitle||''}</span>`);continue}if(aO.vfType==c.ICON){_E.push(`<img class="icon" src="${aO.value}"/>`);continue}if(aO.vfRenderFunc){_E.push(aO.vfRenderFunc(aK,aO,aM,H));continue}const aP=aK[aO.vfAcutalField],aQ=_(aK);if(a(aP)){_E.push(aO.templateShow?aP.map(aS=>f(aO.templateShow,{$item:g(aS)})).join(''):aP.join(', '));continue}let aR=aQ[aO?.vfAcutalField||''];aO?.enum&&b(aO.enum).length>0&&(aR=aO.enum[aR]||aR,aR=g(aR));aO?.templateShow&&(aR=f(aO?.templateShow,{value:g(aR)}));_E.push(aR)}}return _E.join('')};G.addClass('wrapper-table').addClass('custom-scroll');F&&(G.addClass('fixed'),G.css({height:`${_e}px`}));var H=`${A}${~~Math.random()*1e6}`;window[H]=(aF,aG)=>{if(aC){var aH=_d[aG];aC(aF,aH,aG)}};function k(){var aT=$('<table class="dynamic-table"></table>');G.append(aT);this.table=aT;this.data=_d;this.columns=aD;this.templates=aE}k.prototype.drawHeader=function(){var aU=$('<thead></thead>'),aV=$('<tr></tr>');for(const aX of this.columns){var aW=$(`<th> ${aX.title} </th>`);aV.append(aW)}aU.append(aV);this.table.append(aU);return this};k.prototype.drawBody=function(){var aY=$('<tbody></tbody>');for(const[bC,bD] of this.data.entries()){var aZ=$('<tr></tr>');for(const bE of this.columns){var bA=$(`<td></td>`),bB=$('<div class="td-line"></div>');bB.html(j(bD,bE,bC,i));bA.append(bB);aZ.append(bA);bA.css('text-align',bE.align||'left');bA.css('vertical-align',bE.vAlign||'top');bE.width&&bA.css('width',bE.width);bE.minWidth&&bA.css('min-width',bE.minWidth);bE.maxWidth&&bA.css('max-width',bE.maxWidth)}aY.append(aZ)}this.table.append(aY);return this};k.prototype.setTemplate=function(bF){this.templates=bF;return this};k.prototype.setColumns=function(bG){this.columns=bG;return this};k.prototype.setData=function(bH){this.data=bH;return this};k.prototype.reload=function(){this.table.empty();this.drawHeader();this.drawBody();return this};var l=new k();l.drawHeader();l.drawBody();return l};$.fn.flexiTableEdit=function({columns:bI=[],vfFields:bJ=[],actions:bK=[],icons:bL=[],height:bM=390}){var _f=$(this),_g=$('<div class="grid-col-2"></div>');_f.addClass('dynamic-table-edit').addClass('box').addClass('box-grid');_f.css({height:`${bM}px`});_f.append(_g);_g.append(`
      <div class="edit-columns">
        <div class="justify-content-space-between">
          <h5> Columns </h5>
          <div>
            <button class="btn-plus" :disabled="disabled" @click="onAddColumn">✚</button>
          </div>
        </div>
        <hr style="margin: 5px 0"/>
        <ul class="dragArea list-group custom-scroll list-columns">
        </ul>
      </div>

      <div class="edit-columns">
        <h5>Fields</h5>
        <hr style="margin: 5px 0"/>
          <ul class="list-field custom-scroll list-fields">
            <!--
              <li v-for="field in listFields" :key="field.field">
                <div class="label">{{ field.title }}:</div>
                <div class="item" draggable="true" @dragstart="e => onDragstart(e, vfield)" v-for="vfield in field.variants" :key="vfield.vfCode"> {{ vfield.vfTitle }} </div>
              </li>
            -->
          </ul>
      </div>

      <div class="edit-columns etc-field custom-scroll">
        <div>
          <h5>Separator</h5>
          <hr style="margin: 5px 0"/>
          <ul class="list-field-symbol list-separators">
            <!--
              <li v-for="field in symbols" :key="field.vfAcutalField">
                <div class="item" draggable="true" @dragstart="e => onDragstart(e, field)"> {{ field.vfTitle }} </div>
              </li>
            -->
          </ul>
        </div>

        <div style="margin-top: 10px">
          <h5>Actions</h5>
          <hr style="margin: 5px 0"/>
          <ul class="list-field-symbol list-actions">
            <!--
              <li v-for="field in actions" :key="field.vfAcutalField">
                <div class="item btn" draggable="true" @dragstart="e => onDragstart(e, field)"> {{ field.vfTitle }} </div>
              </li>
            -->
          </ul>
        </div>
        
        <div style="margin-top: 10px">
          <h5>Icons</h5>
          <hr style="margin: 5px 0"/>
          <ul class="list-field-symbol list-icons">
            <!--
              <li v-for="field in icons" :key="field.vfAcutalField">
                <img :src="field.value" class="icon" draggable="true" @dragstart="e => onDragstart(e, field)"/>
              </li>
            -->
          </ul>
        </div>
      </div>
    `);function _h(){this.columns=bI;this.vfFields=bJ;this.disabled=!1;this.mapFunction={};this.currentRow=-1;this.btnPlus=_g.find('.btn-plus');this.listColumns=_g.find('.list-columns');this.listFields=_g.find('.list-fields');this.listSeparator=_g.find('.list-separators');this.listActions=_g.find('.list-actions');this.listIcons=_g.find('.list-icons');for(const bP of d){var bN=$('<li></li>'),bO=$(`<div class="item" draggable="true"> ${bP.vfTitle} </div>`);bN.append(bO);this.listSeparator.append(bN);bO.on('dragstart',e=>this.onDragstart(e,bP))}for(const bQ of bK){var bN=$('<li></li>'),bO=$(`<div class="item btn" draggable="true"> ${bQ.vfTitle} </div>`);bN.append(bO);this.listActions.append(bN);bO.on('dragstart',e=>this.onDragstart(e,bQ))}for(const bR of bL){var bN=$('<li></li>'),bO=$(`<img src="${bR.value}" class="icon" draggable="true" />`);bN.append(bO);this.listIcons.append(bN);bO.on('dragstart',e=>this.onDragstart(e,bR))}this.mapFieldInfo=[...bJ,...bL,...bK,...d].reduce((bS,bT)=>{bS[bT.vfCode]=bT;return bS},{});this.drawVfFields();this.drawColumns();this.btnPlus.click(()=>this.addColumn());return this};_h.prototype.drawVfFields=function(){var bU={},bV=[];for(const bZ of this.vfFields){var bW=bZ?.vfAcutalField||'';bU[bW]==void 0?(bV.push({title:bZ.vfActualFieldTitle||'',field:bW,variants:[bZ]}),bU[bW]=bV.length-1):(bV[bU[bW]].variants.push(bZ))}for(const cA of bV){var bX=$('<li></li>'),bY=$(`<div class="label"> ${cA.title}:</div>`);bX.append(bY);for(const cB of cA.variants){var _F=$(`<div class="item" draggable="true"> ${cB.vfTitle} </div>`);bX.append(_F);_F.on('dragstart',e=>this.onDragstart(e,cB))}this.listFields.append(bX)}};_h.prototype.drawColumns=function(){var cC=this;for(const cD of cC.columns)cC._addRow(cD)};_h.prototype.addEventListener=function(cE,cF){this.mapFunction[cE]==void 0&&(this.mapFunction[cE]=[]);this.mapFunction[cE].push(cF)};_h.prototype.emit=function(cG){var cH=this.mapFunction[cG];if(cH&&cH.length>0)for(const cI of cH)cI(this.columns)};_h.prototype._addRow=function(cJ){var cK=this,t=$(`
        <li class="list-group-item">
          <div class="label align-items-center drop-zone">
            <div class="align-items-center">
              <span class="handle">☰</span>
              <div class="inline-block popper-wrapper">
                <button class="btn-more btn-popover">⋯</button>
                <div class="popover-action popover-content">
                  <div>
                    <button class="btn-more btn-align-left">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMTcgMTBIM00yMSA2SDNNMjEgMTRIM00xNyAxOEgzIi8+PC9zdmc+" />
                    </button>
                    <button class="btn-more btn-align-center">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiI+PHBhdGggZD0iTTEyIDI4aDcyYTQgNCAwIDAgMCAwLThIMTJhNCA0IDAgMCAwIDAgOHptOCA4YTQgNCAwIDAgMCAwIDhoNTZhNCA0IDAgMCAwIDAtOEgyMHptNjQgMTZIMTJhNCA0IDAgMCAwIDAgOGg3MmE0IDQgMCAwIDAgMC04em0tOCAxNkgyMGE0IDQgMCAwIDAgMCA4aDU2YTQgNCAwIDAgMCAwLTh6Ii8+PC9zdmc+" />
                    </button>
                    <button class="btn-more btn-align-right">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiI+PHBhdGggZD0iTTg4IDI0YTQgNCAwIDAgMC00LTRIMTJhNCA0IDAgMCAwIDAgOGg3MmE0IDQgMCAwIDAgNC00em0wIDE2YTQgNCAwIDAgMC00LTRIMjhhNCA0IDAgMCAwIDAgOGg1NmE0IDQgMCAwIDAgNC00ek04IDU2YTQgNCAwIDAgMCA0IDRoNzJhNCA0IDAgMCAwIDAtOEgxMmE0IDQgMCAwIDAtNCA0em0xNiAxNmE0IDQgMCAwIDAgNCA0aDU2YTQgNCAwIDAgMCAwLThIMjhhNCA0IDAgMCAwLTQgNHoiLz48L3N2Zz4=" />
                    </button>
                  </div>
                  <div style="margin-top: 4px">
                    <button class="btn-more btn-valign-top">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNOCAxMWgzdjEwaDJWMTFoM2wtNC00LTQgNHpNNCAzdjJoMTZWM0g0eiIvPjwvc3ZnPg==" />
                    </button>
                    <button class="btn-more btn-valign-middle">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNOCAxOWgzdjRoMnYtNGgzbC00LTQtNCA0em04LTE0aC0zVjFoLTJ2NEg4bDQgNCA0LTR6TTQgMTF2MmgxNnYtMkg0eiIvPjwvc3ZnPg==" />
                    </button>
                    <button class="btn-more btn-valign-bottom">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTYgMTNoLTNWM2gtMnYxMEg4bDQgNCA0LTR6TTQgMTl2MmgxNnYtMkg0eiIvPjwvc3ZnPg==" />
                    </button>
                  </div>
                  <div style="margin-top: 4px" class="div-input">
                    <label class="label">width:</label> <input type="text" class="txt-width" placeholder="# px | %"/>
                  </div>
                  <div style="margin-top: 4px" class="div-input">
                    <label class="label">min-width:</label> <input type="text" class="min-width" placeholder="# px | %"/>
                  </div>
                  <div style="margin-top: 4px" class="div-input">
                    <label class="label">max-width:</label> <input type="text" class="max-width" placeholder="# px | %"/>
                  </div>
                  <div class="popper-arrow"></div>
                </div>
              </div>
              
              <input class="input-title" type="text" placeholder="Column name"/>
            </div>
            <ul class="list-selected-field">
              <!--
              <li v-for="vfCode in element.fieldCodes" :key="vfCode">
                <img v-if="mapFieldInfo[vfCode]?.vfType === VfType.ICON" class="icon-selected":src="mapFieldInfo[vfCode]?.value" />
                <span v-else>{{ mapFieldInfo[vfCode]?.vfTitle }}</span>
              </li>
              <li class="no-data">Kéo field vào đây</li>
              -->
            </ul>
          </div>
          <div>
            <button class="btn btn-close" @click.stop="closeIndex(index)" :disabled="disabled">
              ✘
            </button>
          </div>
        </li>
      `),cL=t.find('.drop-zone'),cM=t.find('.input-title'),cN=t.find('.list-selected-field'),cO=t.find('.btn-close'),_G=t.find('.btn-popover'),_H=t.find('.popover-content'),I=t.find('button.btn-align-left'),J=t.find('button.btn-align-center'),K=t.find('button.btn-align-right'),L=t.find('button.btn-valign-top'),m=t.find('button.btn-valign-middle'),n=t.find('button.btn-valign-bottom'),o=t.find('.txt-width'),p=t.find('.min-width'),q=t.find('.max-width'),r=cZ=>{const dA=cK.mapFieldInfo[cZ];if(dA)return dA.vfType==c.ICON?`<img class="icon-selected" src="${dA.value}" />`:`<span>${dA.vfTitle}</span>`;return''};cK.listColumns.append(t);_G.webuiPopover({url:_H,trigger:'click',placement:'right'});_H.click(function(e){e.preventDefault();return!1});cM.val(cJ.title);switch(cJ.align||'left') {case 'left':I.addClass('active');break;case 'center':J.addClass('active');break;case 'right':K.addClass('active');break}switch(cJ.vAlign||'top') {case 'top':L.addClass('active');break;case 'middle':m.addClass('active');break;case 'bottom':n.addClass('active');break}cJ.width&&o.val(cJ.width);cJ.minWidth&&p.val(cJ.minWidth);cJ.maxWidth&&q.val(cJ.maxWidth);_G.click(function(){var cP=$(this);cK.currentRow=cK.listColumns.find('li.list-group-item').index(cP.parent().parent().parent().parent())});I.click(function(){var cQ=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].align='left',cQ.parent().find('.active').removeClass('active'),cQ.addClass('active'),cK.emit('change'))});J.click(function(){var cR=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].align='center',cR.parent().find('.active').removeClass('active'),cR.addClass('active'),cK.emit('change'))});K.click(function(){var cS=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].align='right',cS.parent().find('.active').removeClass('active'),cS.addClass('active'),cK.emit('change'))});L.click(function(){var cT=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].vAlign='top',cT.parent().find('.active').removeClass('active'),cT.addClass('active'),cK.emit('change'))});m.click(function(){var cU=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].vAlign='middle',cU.parent().find('.active').removeClass('active'),cU.addClass('active'),cK.emit('change'))});n.click(function(){var cV=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].vAlign='bottom',cV.parent().find('.active').removeClass('active'),cV.addClass('active'),cK.emit('change'))});o.change(function(){var cW=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].width=cW.val(),cK.emit('change'))});p.change(function(){var cX=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].minWidth=cX.val(),cK.emit('change'))});q.change(function(){var cY=$(this);cK.currentRow>=-1&&cK.columns[cK.currentRow]&&(cK.columns[cK.currentRow].maxWidth=cY.val(),cK.emit('change'))});if(cJ.fieldCodes.length>0){cN.empty();for(const dB of cJ.fieldCodes){var S=r(dB);S&&cN.append(`<li>${S}</li>`)}}else cN.append(`<li class="no-data">Kéo field vào đây</li>`);cL.on('drop',function(e){if(cK.disabled)return!1;e.preventDefault();var dC=$(this),dD=h(e.originalEvent.dataTransfer.getData('text'));dC.parent().removeClass('hover');if(dD?.vfCode){var dE=dC.parent(),dF=cK.listColumns.find('li.list-group-item').index(dE),dG=dC.find('.list-selected-field'),dH=r(dD.vfCode);cK.columns[dF].fieldCodes.push(dD.vfCode);dG.find('li.no-data').remove();dH&&dG.append(`<li>${dH}</li>`);cK.emit('change')}});cL.on('dragover',function(e){if(cK.disabled)return!1;e.preventDefault();$(this).parent().addClass('hover')});cL.on('dragleave',function(){$(this).parent().removeClass('hover')});cM.change(function(){var dI=$(this),dJ=cK.listColumns.find('li.list-group-item').index(dI.parent().parent().parent());cK.columns[dJ].title=dI.val();cK.emit('change')});cO.click(function(){var dK=$(this),dL=cK.listColumns.find('li.list-group-item').index(dK.parent().parent());cK.columns[dL].fieldCodes.length>0?(cK.columns[dL].fieldCodes.length=0,_f.find('.list-selected-field').empty().append(`<li class="no-data">Kéo field vào đây</li>`)):(cK.columns.splice(dL,1),cK.listColumns.find('li.list-group-item').eq(dL).remove());this.emit('change')})};_h.prototype.addColumn=function(){var dM={title:'',fieldCodes:[]};this.columns.push(dM);this.emit('change');this._addRow(dM)};_h.prototype.onDragstart=function(e,dN){e.originalEvent.dataTransfer.setData('text',JSON.stringify(dN))};_h.prototype.setColumns=function(dO){this.columns=dO;this.listColumns.empty();this.drawColumns()};return new _h()};$.fn.flexiTableFull=function({data:dT=[],vfFields:dU=[],actions:dV=[],icons:dW=[],tableHeight:_i=300,tableFixed:_j=!1,editHeight:_k=390,layouts:_l=[],isShowLayout:M=!0,isShowOption:N=!0,onCta:dP,onDeleteLayout:dQ,onSaveLayout:dR,onSetDefaultLayout:dS}){var O=$(this);O.addClass('flexi-table-full');function P(){this.layouts=_l;this.data=dT;this.objEdit={tablePreview:null,tableEdit:null,layoutsEdit:[],popupEdit:null,ddlLayoutEdit:null,btnClone:null,btnDelete:null,btnSave:null,btnDefault:null,btnCopy:null};this.layoutId=_l?.length>0?_l[0].id:'';this.layoutIndex=0;this.ddl=null;this.btnOption=null;this.objTableMain=null;this.drawHeader();this.drawTable()};P.prototype.drawHeader=function(){var dX=this;if(M||N){var dY=$('<div class="justify-content-space-between" style="margin-bottom: 8px;"></div>'),dZ=$('<div class="align-items-center"></div>');dY.append(dZ);if(M){dZ.append('<h4>Layout:</h4>');var eA=$('<select class="select-layout" placeholder="Chọn layout"></select>');dZ.append(eA);dX.ddl=eA;if(dX.layouts.length>0)for(const eC of dX.layouts)eA.append(`<option value="${eC.id}">${eC.title}</option>`);eA.change(function(){dX.changeLayout($(this).val())})}if(N){var eB=$('<button class="btn-option">🛠</button>');dY.append(eB);dX.btnOption=eB;dX.drawPopup();eB.click(function(){dX.showPopupEdit()})}O.append(dY)}};P.prototype.drawTable=function(){var eD=this,eE=$('<div></div>');O.append(eE);eD.objTableMain=eE.flexiTable({columns:eD.layouts?.length>0?eD.layouts[0].columns:[],templates:[...dU,...dW,...dV],data:dT,height:_i,fixed:_j,onCta:function(eF,eG,eH){dP(eF,eG,eH)}})};P.prototype.changeLayout=function(eI){var eJ=this.layouts.findIndex(eK=>eK.id==eI);this.objTableMain.setColumns(this.layouts[eJ].columns);this.objTableMain.reload()};P.prototype.drawPopup=function(){var eL=this,eM=eL.objEdit.popupEdit.find('.table-preview'),eN=eL.objEdit.popupEdit.find('.table-edit');eL.objEdit.popupEdit=$(`
        <div class="popup-edit-wrapper">
          <div class="popup-content">
            <div class="justify-content-space-between" style="margin-bottom: 10px">
              <h3>[Nâng cao] Cấu hình cách hiển thị bảng dữ liệu</h3>
              <button class="btn-close"> ❌ </button>
            </div>

            <div class="table-preview"></div>

            <div class="align-items-center">
              <h4>Tên layout:</h4>
              <select class="select-layout"></select>

              <button class="btn-clone">Clone</button>
              <button class="btn-delete">Xóa</button>
              <button class="btn-save">Lưu</button>
              <button class="btn-default">Default</button>
              <button class="btn-copy">Copy</button>
            </div>

            <div class="table-edit"></div>
          </div>
        </div>
      `);O.after(eL.objEdit.popupEdit);eL.objEdit.popupEdit.find('.btn-close').click(function(){eL.objEdit.popupEdit.css('display','none')});eL.objEdit.ddlLayoutEdit=eL.objEdit.popupEdit.find('.select-layout');eL.objEdit.btnClone=eL.objEdit.popupEdit.find('.btn-clone');eL.objEdit.btnDelete=eL.objEdit.popupEdit.find('.btn-delete');eL.objEdit.btnSave=eL.objEdit.popupEdit.find('.btn-save');eL.objEdit.btnDefault=eL.objEdit.popupEdit.find('.btn-default');eL.objEdit.btnCopy=eL.objEdit.popupEdit.find('.btn-copy');eL.objEdit.tablePreview=eM.flexiTable({columns:eL.layouts?.length>0?eL.layouts[0].columns:[],templates:[...dU,...dW,...dV],data:eL.data,height:300,fixed:!0,onCta:function(eO,eP,eQ){console.log(eO,eP,eQ)}});eL.objEdit.tableEdit=eN.flexiTableEdit({columns:[],icons:dW,actions:dV,vfFields:dU,height:_k});eL.objEdit.tableEdit.addEventListener('change',eR=>{var eS=eL.objEdit.ddlLayoutEdit[0].selectedIndex;eL.objEdit.tablePreview.setColumns(eR);eL.objEdit.tablePreview.reload();eL.objEdit.layoutsEdit[eS].columns=eR});eL.objEdit.ddlLayoutEdit.change(function(){var eT=this.selectedIndex,eU=eL.objEdit.layoutsEdit[eT].columns;eL.objEdit.tablePreview.setColumns(eU);eL.objEdit.tablePreview.reload();eL.objEdit.tableEdit.setColumns(eU);eL.objEdit.btnDelete.attr('disabled',eL.objEdit.layoutsEdit[eT].isSystem);eL.objEdit.btnSave.attr('disabled',eL.objEdit.layoutsEdit[eT].isSystem);eL.objEdit.btnCopy.attr('disabled',eL.objEdit.layoutsEdit[eT].isSystem);eL.objEdit.btnDefault.attr('disabled',!eL.objEdit.layoutsEdit[eT].id)});eL.objEdit.btnClone.click(()=>{var eV=eL.objEdit.ddlLayoutEdit[0].selectedIndex,eW=eL.objEdit.layoutsEdit[eV],eX={title:`${eW.title} clone`,id:'',isSystem:!1,isDefault:!1,columns:JSON.parse(JSON.stringify(eL.objEdit.layoutsEdit[eV].columns))};eL.objEdit.layoutsEdit.push(eX);eL.objEdit.ddlLayoutEdit.append(`<option value="${eX.id}">${eX.title}</option>`);eL.objEdit.ddlLayoutEdit[0].selectedIndex=eL.objEdit.layoutsEdit.length-1;eL.objEdit.ddlLayoutEdit.trigger('change')});eL.objEdit.btnDelete.click(()=>{if(confirm('Bạn muốn xóa layout này không?')){var eY=eL.objEdit.ddlLayoutEdit[0].selectedIndex,eZ=()=>{eL.objEdit.layoutsEdit.splice(eY,1);eL.objEdit.ddlLayoutEdit.find('option').eq(eY).remove();eL.objEdit.ddlLayoutEdit.trigger('change')};eL.objEdit.layoutsEdit[eY].id&&dQ?dQ(eL.objEdit.layoutsEdit[eY],()=>eZ()):eZ()}});eL.objEdit.btnSave.click(()=>{var fA=eL.objEdit.ddlLayoutEdit[0].selectedIndex;dR&&dR(eL.objEdit.layoutsEdit[fA],fB=>{eL.objEdit.layoutsEdit[fA].id=fB;eL.objEdit.ddlLayoutEdit.trigger('change')})});eL.objEdit.btnDefault.click(()=>{var fC=eL.objEdit.ddlLayoutEdit[0].selectedIndex;dS&&dS(eL.objEdit.layoutsEdit[fC])});eL.objEdit.btnCopy.click(async ()=>{var fD=eL.objEdit.ddlLayoutEdit[0].selectedIndex;try {await navigator.clipboard.writeText(JSON.stringify(eL.objEdit.layoutsEdit[fD].columns));console.log('Copied')} catch {console.error('Copy not support')}})};P.prototype.showPopupEdit=function(){var fE=this;fE.objEdit.popupEdit?.css('display','block');fE.objEdit.layoutsEdit=JSON.parse(JSON.stringify(fE.layouts));fE.objEdit.ddlLayoutEdit.empty();for(const fF of fE.objEdit.layoutsEdit)fE.objEdit.ddlLayoutEdit.append(`<option value="${fF.id}">${fF.title}</option>`);fE.objEdit.ddlLayoutEdit.trigger('change')};return new P()}})(jQuery);
