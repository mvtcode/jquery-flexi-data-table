var A=a=>typeof a=='function',{isArray:b}=Array,{keys:_}=Object;(function($){var B='0.2.0-jquery',C='tdac',d={DATA:'DATA',SYMBOL:'SYMBOL',ACTION:'ACTION',ICON:'ICON'},E=[{vfTitle:'⌴',vfCode:'space',vfType:d.SYMBOL,vfAcutalField:'space',vfActualFieldTitle:'Dấu cách',value:'&nbsp;'},{vfTitle:'↩',vfCode:'newline',vfType:d.SYMBOL,vfAcutalField:'newline',vfActualFieldTitle:'NewLine',value:'<br/>'},{vfTitle:'-',vfCode:'minus',vfType:d.SYMBOL,vfAcutalField:'minus',vfActualFieldTitle:'Dấu trừ',value:'&hyphen;'},{vfTitle:'|',vfCode:'vertical',vfType:d.SYMBOL,vfAcutalField:'vertical',vfActualFieldTitle:'Dấu dọc',value:'|'},{vfTitle:',',vfCode:'comma',vfType:d.SYMBOL,vfAcutalField:'comma',vfActualFieldTitle:'Dấu phẩy',value:','},{vfTitle:'.',vfCode:'dot',vfType:d.SYMBOL,vfAcutalField:'dot',vfActualFieldTitle:'Dấu chấm',value:'.'},{vfTitle:';',vfCode:'semicolon',vfType:d.SYMBOL,vfAcutalField:'semicolon',vfActualFieldTitle:'Chấm phẩy',value:';'},{vfTitle:'[',vfCode:'openBracket',vfType:d.SYMBOL,vfAcutalField:'openBracket',vfActualFieldTitle:'Mở ngoặc vuông',value:'['},{vfTitle:']',vfCode:'closeBracket',vfType:d.SYMBOL,vfAcutalField:'closeBracket',vfActualFieldTitle:'Đóng ngoặc vuông',value:']'},{vfTitle:'(',vfCode:'openRoundBracket',vfType:d.SYMBOL,vfAcutalField:'openRoundBracket',vfActualFieldTitle:'Mở ngoặc tròn',value:'('},{vfTitle:')',vfCode:'closeRoundBracket',vfType:d.SYMBOL,vfAcutalField:'closeRoundBracket',vfActualFieldTitle:'Đóng hoặc tròn',value:')'}],g=(aA,_B={})=>aA.replace(/\{\{(.*?)\}\}/g,(aB,aC)=>{const _C=_B[aC];return (_C!==void 0&&_C!==null)?_C:aB}),h=aD=>`${aD}`.replace(/[&<>"'`=\/]/g,s=>{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'}[s]),i=aE=>{try {return JSON.parse(aE)} catch {return null}};function f(_a={},_b='',_c={}){for(const _A of _(_a)){var D=_b?`${_b}.${_A}`:_A;typeof _a[_A]=='object'&&_a[_A]!==null?f(_a[_A],D,_c):_c[D]=_a[_A]}return _c}function j(){return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16)})}$.fn.flexiTable=function({columns:aG=[],templates:aH=[],data:_d=[],height:_e=300,fixed:F=!1,onCta:aF}){var G=$(this),I=[...aH,...E].reduce((aL,aM)=>{aL[aM.vfCode]=aM;return aL},{}),J=(aN={},aO,aP,_D={})=>{const _E=[];for(const aQ of aO.fieldCodes){const aR=_D[aQ];if(aR){if(aR.vfType==d.SYMBOL){_E.push(aR?.value||'');continue}if(aR.vfType==d.ACTION){_E.push(`<span class="btn btn-${aR.vfAcutalField}" onClick="${H}('${aR.vfCode}', ${aP})">${aR?.vfTitle||''}</span>`);continue}if(aR.vfType==d.ICON){_E.push(`<img class="icon" src="${aR.value}"/>`);continue}if(aR.vfRenderFunc){_E.push(aR.vfRenderFunc(aN,aR,aP,H));continue}const aS=aN[aR.vfAcutalField],aT=f(aN);if(b(aS)){_E.push(aR.templateShow?aS.map(aV=>g(aR.templateShow,{$item:h(aV)})).join(''):aS.join(', '));continue}let aU=aT[aR?.vfAcutalField||''];aR?.enum&&_(aR.enum).length>0&&(aU=aR.enum[aU]||aU,aU=h(aU));aR?.templateShow&&(aU=g(aR?.templateShow,{value:h(aU)}));_E.push(aU)}}return _E.join('')};G.addClass('wrapper-table').addClass('custom-scroll');F&&(G.addClass('fixed'),G.css({height:`${_e}px`}));var H=`${C}${~~Math.random()*1e6}`;window[H]=(aI,aJ)=>{if(aF){var aK=_d[aJ];aF(aI,aK,aJ)}};function k(){var aW=$('<table class="dynamic-table"></table>');G.append(aW);this.table=aW;this.data=_d;this.columns=aG;this.templates=aH}k.prototype.drawHeader=function(){var aX=$('<thead></thead>'),aY=$('<tr></tr>');for(const bA of this.columns){var aZ=$(`<th> ${bA.title} </th>`);aY.append(aZ)}aX.append(aY);this.table.append(aX);return this};k.prototype.drawBody=function(){var bB=$('<tbody></tbody>');for(const[bF,bG] of this.data.entries()){var bC=$('<tr></tr>');for(const bH of this.columns){var bD=$(`<td></td>`),bE=$('<div class="td-line"></div>');bE.html(J(bG,bH,bF,I));bD.append(bE);bC.append(bD);bD.css('text-align',bH.align||'left');bD.css('vertical-align',bH.vAlign||'top');bH.width&&bD.css('width',bH.width);bH.minWidth&&bD.css('min-width',bH.minWidth);bH.maxWidth&&bD.css('max-width',bH.maxWidth)}bB.append(bC)}this.table.append(bB);return this};k.prototype.setTemplate=function(bI){this.templates=bI;return this};k.prototype.setColumns=function(bJ){this.columns=bJ;return this};k.prototype.setData=function(bK){this.data=bK;return this};k.prototype.reload=function(){this.table.empty();this.drawHeader();this.drawBody();return this};var l=new k();l.drawHeader();l.drawBody();return l};$.fn.flexiTableEdit=function({columns:bL=[],vfFields:bM=[],actions:bN=[],icons:bO=[],height:bP=390}){var _f=$(this),_g=$('<div class="grid-col-2"></div>');_f.addClass('dynamic-table-edit').addClass('box').addClass('box-grid');_f.css({height:`${bP}px`});_f.append(_g);_g.append(`
      <div class="edit-columns">
        <div class="justify-content-space-between">
          <h5> Columns </h5>
          <div>
            <button class="btn-plus">✚</button>
          </div>
        </div>
        <hr style="margin: 5px 0"/>
        <ul class="dragArea list-group custom-scroll list-columns">
        </ul>
      </div>

      <div class="edit-columns">
        <h5>Fields</h5>
        <hr style="margin: 5px 0"/>
          <ul class="list-field custom-scroll list-fields">
          </ul>
      </div>

      <div class="edit-columns etc-field custom-scroll">
        <div>
          <h5>Separator</h5>
          <hr style="margin: 5px 0"/>
          <ul class="list-field-symbol list-separators">
          </ul>
        </div>

        <div style="margin-top: 10px">
          <h5>Actions</h5>
          <hr style="margin: 5px 0"/>
          <ul class="list-field-symbol list-actions">
          </ul>
        </div>
        
        <div style="margin-top: 10px">
          <h5>Icons</h5>
          <hr style="margin: 5px 0"/>
          <ul class="list-field-symbol list-icons">
          </ul>
        </div>
      </div>
    `);function _h(){this.columns=bL;this.vfFields=bM;this.disabled=!1;this.mapFunction={};this.currentRow=-1;this.btnPlus=_g.find('.btn-plus');this.listColumns=_g.find('.list-columns');this.listFields=_g.find('.list-fields');this.listSeparator=_g.find('.list-separators');this.listActions=_g.find('.list-actions');this.listIcons=_g.find('.list-icons');for(const bS of E){var bQ=$('<li></li>'),bR=$(`<div class="item" draggable="true"> ${bS.vfTitle} </div>`);bQ.append(bR);this.listSeparator.append(bQ);bR.on('dragstart',e=>this.onDragstart(e,bS))}for(const bT of bN){var bQ=$('<li></li>'),bR=$(`<div class="item btn" draggable="true"> ${bT.vfTitle} </div>`);bQ.append(bR);this.listActions.append(bQ);bR.on('dragstart',e=>this.onDragstart(e,bT))}for(const bU of bO){var bQ=$('<li></li>'),bR=$(`<img src="${bU.value}" class="icon" draggable="true" />`);bQ.append(bR);this.listIcons.append(bQ);bR.on('dragstart',e=>this.onDragstart(e,bU))}this.mapFieldInfo=[...bM,...bO,...bN,...E].reduce((bV,bW)=>{bV[bW.vfCode]=bW;return bV},{});this.drawVfFields();this.drawColumns();this.btnPlus.click(()=>this.addColumn());return this};_h.prototype.drawVfFields=function(){var bX={},bY=[];for(const cC of this.vfFields){var bZ=cC?.vfAcutalField||'';bX[bZ]==void 0?(bY.push({title:cC.vfActualFieldTitle||'',field:bZ,variants:[cC]}),bX[bZ]=bY.length-1):(bY[bX[bZ]].variants.push(cC))}for(const cD of bY){var cA=$('<li></li>'),cB=$(`<div class="label"> ${cD.title}:</div>`);cA.append(cB);for(const cE of cD.variants){var _F=$(`<div class="item" draggable="true"> ${cE.vfTitle} </div>`);cA.append(_F);_F.on('dragstart',e=>this.onDragstart(e,cE))}this.listFields.append(cA)}};_h.prototype.drawColumns=function(){var cF=this;for(const cG of cF.columns)cF._addRow(cG)};_h.prototype.addEventListener=function(cH,cI){this.mapFunction[cH]==void 0&&(this.mapFunction[cH]=[]);this.mapFunction[cH].push(cI)};_h.prototype.emit=function(cJ){var cK=this.mapFunction[cJ];if(cK&&cK.length>0)for(const cL of cK)cL(this.columns)};_h.prototype._addRow=function(cM){var cN=this,t=$(`
        <li class="list-group-item">
          <div class="label align-items-center drop-zone">
            <div class="align-items-center">
              <span class="handle">☰</span>
              <div class="inline-block popper-wrapper">
                <button class="btn-more btn-popover">⋯</button>
                <div class="popover-action popover-content">
                  <div>
                    <button class="btn-more btn-align-left">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMTcgMTBIM00yMSA2SDNNMjEgMTRIM00xNyAxOEgzIi8+PC9zdmc+" />
                    </button>
                    <button class="btn-more btn-align-center">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiI+PHBhdGggZD0iTTEyIDI4aDcyYTQgNCAwIDAgMCAwLThIMTJhNCA0IDAgMCAwIDAgOHptOCA4YTQgNCAwIDAgMCAwIDhoNTZhNCA0IDAgMCAwIDAtOEgyMHptNjQgMTZIMTJhNCA0IDAgMCAwIDAgOGg3MmE0IDQgMCAwIDAgMC04em0tOCAxNkgyMGE0IDQgMCAwIDAgMCA4aDU2YTQgNCAwIDAgMCAwLTh6Ii8+PC9zdmc+" />
                    </button>
                    <button class="btn-more btn-align-right">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiI+PHBhdGggZD0iTTg4IDI0YTQgNCAwIDAgMC00LTRIMTJhNCA0IDAgMCAwIDAgOGg3MmE0IDQgMCAwIDAgNC00em0wIDE2YTQgNCAwIDAgMC00LTRIMjhhNCA0IDAgMCAwIDAgOGg1NmE0IDQgMCAwIDAgNC00ek04IDU2YTQgNCAwIDAgMCA0IDRoNzJhNCA0IDAgMCAwIDAtOEgxMmE0IDQgMCAwIDAtNCA0em0xNiAxNmE0IDQgMCAwIDAgNCA0aDU2YTQgNCAwIDAgMCAwLThIMjhhNCA0IDAgMCAwLTQgNHoiLz48L3N2Zz4=" />
                    </button>
                  </div>
                  <div style="margin-top: 4px">
                    <button class="btn-more btn-valign-top">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNOCAxMWgzdjEwaDJWMTFoM2wtNC00LTQgNHpNNCAzdjJoMTZWM0g0eiIvPjwvc3ZnPg==" />
                    </button>
                    <button class="btn-more btn-valign-middle">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNOCAxOWgzdjRoMnYtNGgzbC00LTQtNCA0em04LTE0aC0zVjFoLTJ2NEg4bDQgNCA0LTR6TTQgMTF2MmgxNnYtMkg0eiIvPjwvc3ZnPg==" />
                    </button>
                    <button class="btn-more btn-valign-bottom">
                      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTYgMTNoLTNWM2gtMnYxMEg4bDQgNCA0LTR6TTQgMTl2MmgxNnYtMkg0eiIvPjwvc3ZnPg==" />
                    </button>
                  </div>
                  <div style="margin-top: 4px" class="div-input">
                    <label class="label">width:</label> <input type="text" class="txt-width" placeholder="# px | %"/>
                  </div>
                  <div style="margin-top: 4px" class="div-input">
                    <label class="label">min-width:</label> <input type="text" class="min-width" placeholder="# px | %"/>
                  </div>
                  <div style="margin-top: 4px" class="div-input">
                    <label class="label">max-width:</label> <input type="text" class="max-width" placeholder="# px | %"/>
                  </div>
                  <div class="popper-arrow"></div>
                </div>
              </div>
              
              <input class="input-title" type="text" placeholder="Column name"/>
            </div>
            <ul class="list-selected-field">
            </ul>
          </div>
          <div>
            <button class="btn btn-close">
              ✘
            </button>
          </div>
        </li>
      `),cO=t.find('.drop-zone'),cP=t.find('.input-title'),cQ=t.find('.list-selected-field'),cR=t.find('.btn-close'),_G=t.find('.btn-popover'),_H=t.find('.popover-content'),_i=t.find('button.btn-align-left'),_j=t.find('button.btn-align-center'),K=t.find('button.btn-align-right'),L=t.find('button.btn-valign-top'),m=t.find('button.btn-valign-middle'),n=t.find('button.btn-valign-bottom'),o=t.find('.txt-width'),p=t.find('.min-width'),q=t.find('.max-width'),R=dC=>{const dD=cN.mapFieldInfo[dC];if(dD)return dD.vfType==d.ICON?`<img class="icon-selected" src="${dD.value}" />`:`<span>${dD.vfTitle}</span>`;return''};cN.listColumns.append(t);_G.webuiPopover({url:_H,trigger:'click',placement:'right'});_H.click(function(e){e.preventDefault();return!1});cP.val(cM.title);switch(cM.align||'left') {case 'left':_i.addClass('active');break;case 'center':_j.addClass('active');break;case 'right':K.addClass('active');break}switch(cM.vAlign||'top') {case 'top':L.addClass('active');break;case 'middle':m.addClass('active');break;case 'bottom':n.addClass('active');break}cM.width&&o.val(cM.width);cM.minWidth&&p.val(cM.minWidth);cM.maxWidth&&q.val(cM.maxWidth);_G.click(function(){var cS=$(this);cN.currentRow=cN.listColumns.find('li.list-group-item').index(cS.parent().parent().parent().parent())});_i.click(function(){var cT=$(this);cN.currentRow>=-1&&cN.columns[cN.currentRow]&&(cN.columns[cN.currentRow].align='left',cT.parent().find('.active').removeClass('active'),cT.addClass('active'),cN.emit('change'))});_j.click(function(){var cU=$(this);cN.currentRow>=-1&&cN.columns[cN.currentRow]&&(cN.columns[cN.currentRow].align='center',cU.parent().find('.active').removeClass('active'),cU.addClass('active'),cN.emit('change'))});K.click(function(){var cV=$(this);cN.currentRow>=-1&&cN.columns[cN.currentRow]&&(cN.columns[cN.currentRow].align='right',cV.parent().find('.active').removeClass('active'),cV.addClass('active'),cN.emit('change'))});L.click(function(){var cW=$(this);cN.currentRow>=-1&&cN.columns[cN.currentRow]&&(cN.columns[cN.currentRow].vAlign='top',cW.parent().find('.active').removeClass('active'),cW.addClass('active'),cN.emit('change'))});m.click(function(){var cX=$(this);cN.currentRow>=-1&&cN.columns[cN.currentRow]&&(cN.columns[cN.currentRow].vAlign='middle',cX.parent().find('.active').removeClass('active'),cX.addClass('active'),cN.emit('change'))});n.click(function(){var cY=$(this);cN.currentRow>=-1&&cN.columns[cN.currentRow]&&(cN.columns[cN.currentRow].vAlign='bottom',cY.parent().find('.active').removeClass('active'),cY.addClass('active'),cN.emit('change'))});o.change(function(){var cZ=$(this);cN.currentRow>=-1&&cN.columns[cN.currentRow]&&(cN.columns[cN.currentRow].width=cZ.val(),cN.emit('change'))});p.change(function(){var dA=$(this);cN.currentRow>=-1&&cN.columns[cN.currentRow]&&(cN.columns[cN.currentRow].minWidth=dA.val(),cN.emit('change'))});q.change(function(){var dB=$(this);cN.currentRow>=-1&&cN.columns[cN.currentRow]&&(cN.columns[cN.currentRow].maxWidth=dB.val(),cN.emit('change'))});if(cM.fieldCodes.length>0){cQ.empty();for(const dE of cM.fieldCodes){var S=R(dE);S&&cQ.append(`<li>${S}</li>`)}}else cQ.append(`<li class="no-data">Kéo field vào đây</li>`);cO.on('drop',function(e){if(cN.disabled)return!1;e.preventDefault();var dF=$(this),dG=i(e.originalEvent.dataTransfer.getData('text'));dF.parent().removeClass('hover');if(dG?.vfCode){var dH=dF.parent(),dI=cN.listColumns.find('li.list-group-item').index(dH),dJ=dF.find('.list-selected-field'),dK=R(dG.vfCode);cN.columns[dI].fieldCodes.push(dG.vfCode);dJ.find('li.no-data').remove();dK&&dJ.append(`<li>${dK}</li>`);cN.emit('change')}});cO.on('dragover',function(e){if(cN.disabled)return!1;e.preventDefault();$(this).parent().addClass('hover')});cO.on('dragleave',function(){$(this).parent().removeClass('hover')});cP.change(function(){var dL=$(this),dM=cN.listColumns.find('li.list-group-item').index(dL.parent().parent().parent());cN.columns[dM].title=dL.val();cN.emit('change')});cR.click(function(){var dN=$(this),dO=dN.parent().parent(),dP=cN.listColumns.find('li.list-group-item').index(dO);cN.columns[dP].fieldCodes.length>0?(cN.columns[dP].fieldCodes.length=0,dO.find('.list-selected-field').empty().append(`<li class="no-data">Kéo field vào đây</li>`)):(cN.columns.splice(dP,1),cN.listColumns.find('li.list-group-item').eq(dP).remove());cN.emit('change')})};_h.prototype.addColumn=function(){var dQ={title:'',fieldCodes:[]};this.columns.push(dQ);this.emit('change');this._addRow(dQ)};_h.prototype.onDragstart=function(e,dR){e.originalEvent.dataTransfer.setData('text',JSON.stringify(dR))};_h.prototype.setColumns=function(dS){this.columns=dS;this.listColumns.empty();this.drawColumns()};return new _h()};$.fn.flexiTableFull=function({data:dY=[],vfFields:dZ=[],actions:eA=[],icons:_I=[],tableHeight:_J=300,tableFixed:_k=!1,editHeight:_l=390,layouts:M=[],defaultId:N='',isShowLayout:O=!0,isShowOption:P=!0,onCta:dT,onDeleteLayout:dU,onSaveLayout:dV,onSetDefaultLayout:dW,onCopy:dX}){var Q=$(this);Q.addClass('flexi-table-full');function _r(){this.layouts=M;this.data=dY;this.objEdit={tablePreview:null,tableEdit:null,layoutsEdit:[],popupEdit:null,ddlLayoutEdit:null,btnClone:null,btnDelete:null,btnSave:null,btnDefault:null,btnCopy:null,popupSave:{txtLayoutName:null,btnCancel:null,btnOk:null}};this.layoutId=M?.length>0?M[0].id:'';this.layoutIndex=0;this.ddl=null;this.btnOption=null;this.objTableMain=null;this.drawHeader();this.drawTable();var eB=this.layouts.findIndex(eC=>eC.id==N);eB>=0&&(this.ddl[0].selectedIndex=eB,this.changeLayout(N))};_r.prototype.drawHeader=function(){var eD=this;if(O||P){var eE=$('<div class="justify-content-space-between" style="margin-bottom: 8px;"></div>'),eF=$('<div class="align-items-center"></div>');eE.append(eF);if(O){eF.append('<h4>Layout:</h4>');var eG=$('<select class="select-layout" placeholder="Chọn layout"></select>');eF.append(eG);eD.ddl=eG;if(eD.layouts.length>0)for(const eI of eD.layouts)eG.append(`<option value="${eI.id}">${eI.title}</option>`);eG.change(function(){eD.changeLayout($(this).val())})}if(P){var eH=$('<button class="btn-option">🛠</button>');eE.append(eH);eD.btnOption=eH;eD.drawPopup();eH.click(function(){eD.showPopupEdit()})}Q.append(eE)}};_r.prototype.drawTable=function(){var eJ=this,eK=$('<div></div>');Q.append(eK);eJ.objTableMain=eK.flexiTable({columns:eJ.layouts?.length>0?eJ.layouts[0].columns:[],templates:[...dZ,..._I,...eA],data:eJ.data,height:_J,fixed:_k,onCta:function(eL,eM,eN){dT(eL,eM,eN)}})};_r.prototype.setData=function(eO){this.data=eO;self.objTableMain.setData(eO);self.objTableMain.reload()};_r.prototype.setLayouts=function(eP){this.layouts=eP;this.ddl.empty();if(this.layouts.length>0)for(const eQ of this.layouts)this.ddl.append(`<option value="${eQ.id}">${eQ.title}</option>`)};_r.prototype.changeLayout=function(eR){this.ddl.val(eR);var eS=this.layouts.findIndex(eT=>eT.id==eR);this.objTableMain.setColumns(this.layouts[eS].columns);this.objTableMain.reload()};_r.prototype.drawPopup=function(){var eU=this,eV=eU.objEdit.popupEdit.find('.table-preview'),eW=eU.objEdit.popupEdit.find('.table-edit'),eX=eU.objEdit.popupEdit.find('.popover-save'),eY=eU.objEdit.btnSave.webuiPopover({url:eX,trigger:'click',placement:'bottom'});eU.objEdit.popupEdit=$(`
        <div class="popup-edit-wrapper">
          <div class="popup-content">
            <div class="justify-content-space-between" style="margin-bottom: 10px">
              <h3>[Nâng cao] Cấu hình cách hiển thị bảng dữ liệu</h3>
              <button class="btn-close"> ❌ </button>
            </div>

            <div class="table-preview"></div>

            <div class="justify-content-space-between">
              <div class="align-items-center">
                <h4>Tên layout:</h4>
                <select class="select-layout"></select>
                <button class="btn-clone">Clone</button>
                <button class="btn-delete">Xóa</button>
                <button class="btn-save">Lưu</button>
                <button class="btn-default">Default</button>
                <button class="btn-copy">Copy</button>
              </div>
              <div class="version">
                version: ${B}
              </div>
            </div>

            <div class="table-edit"></div>

            <div class="popover-save">
              <div>
                <input class="txt-layout-name" type="text"/>
              </div>
              <div class="justify-content-end" style="margin-top: 4px">
                <button class="btn-cancel">Hủy</button>
                <button class="btn-save-confirm">OK</button>
              </div>
            </div>
          </div>
        </div>
      `);Q.after(eU.objEdit.popupEdit);eU.objEdit.popupEdit.find('.btn-close').click(function(){eU.objEdit.popupEdit.css('display','none')});eU.objEdit.ddlLayoutEdit=eU.objEdit.popupEdit.find('.select-layout');eU.objEdit.btnClone=eU.objEdit.popupEdit.find('.btn-clone');eU.objEdit.btnDelete=eU.objEdit.popupEdit.find('.btn-delete');eU.objEdit.btnSave=eU.objEdit.popupEdit.find('.btn-save');eU.objEdit.btnDefault=eU.objEdit.popupEdit.find('.btn-default');eU.objEdit.btnCopy=eU.objEdit.popupEdit.find('.btn-copy');eU.objEdit.popupSave.txtLayoutName=eU.objEdit.popupEdit.find('.txt-layout-name');eU.objEdit.popupSave.btnCancel=eU.objEdit.popupEdit.find('.btn-cancel');eU.objEdit.popupSave.btnOk=eU.objEdit.popupEdit.find('.btn-save-confirm');eU.objEdit.tablePreview=eV.flexiTable({columns:eU.layouts?.length>0?eU.layouts[0].columns:[],templates:[...dZ,..._I,...eA],data:[],height:300,fixed:!0,onCta:function(eZ,fA,fB){console.log(eZ,fA,fB)}});eU.objEdit.tableEdit=eW.flexiTableEdit({columns:[],icons:_I,actions:eA,vfFields:dZ,height:_l});eU.objEdit.tableEdit.addEventListener('change',fC=>{var fD=eU.objEdit.ddlLayoutEdit[0].selectedIndex;eU.objEdit.tablePreview.setColumns(fC);eU.objEdit.tablePreview.reload();eU.objEdit.layoutsEdit[fD].columns=fC});eU.objEdit.ddlLayoutEdit.change(function(){var fE=this.selectedIndex,fF=eU.objEdit.layoutsEdit[fE].columns;eU.objEdit.tablePreview.setColumns(fF);eU.objEdit.tablePreview.reload();eU.objEdit.tableEdit.setColumns(fF);eU.objEdit.btnDelete.attr('disabled',eU.objEdit.layoutsEdit[fE].isSystem);eU.objEdit.btnSave.attr('disabled',eU.objEdit.layoutsEdit[fE].isSystem);eU.objEdit.btnCopy.attr('disabled',eU.objEdit.layoutsEdit[fE].isSystem);eU.objEdit.btnDefault.attr('disabled',!eU.objEdit.layoutsEdit[fE].id)});eU.objEdit.btnClone.click(()=>{var fG=eU.objEdit.ddlLayoutEdit[0].selectedIndex,fH=eU.objEdit.layoutsEdit[fG],fI={title:`${fH.title} clone`,id:'',isSystem:!1,isDefault:!1,columns:JSON.parse(JSON.stringify(eU.objEdit.layoutsEdit[fG].columns))};eU.objEdit.layoutsEdit.push(fI);eU.objEdit.ddlLayoutEdit.append(`<option value="${fI.id}">${fI.title}</option>`);eU.objEdit.ddlLayoutEdit[0].selectedIndex=eU.objEdit.layoutsEdit.length-1;eU.objEdit.ddlLayoutEdit.trigger('change')});eU.objEdit.btnDelete.click(()=>{if(confirm('Bạn muốn xóa layout này không?')){var fJ=eU.objEdit.ddlLayoutEdit[0].selectedIndex,fK=()=>{eU.objEdit.layoutsEdit.splice(fJ,1);eU.objEdit.ddlLayoutEdit.find('option').eq(fJ).remove();eU.objEdit.ddlLayoutEdit.trigger('change')};eU.objEdit.layoutsEdit[fJ].id&&dU?dU(eU.objEdit.layoutsEdit[fJ],()=>fK()):fK()}});eU.objEdit.btnSave.click(()=>{var fL=eU.objEdit.ddlLayoutEdit[0].selectedIndex;eU.objEdit.popupSave.txtLayoutName.val(eU.objEdit.layoutsEdit[fL].title);setTimeout(()=>eU.objEdit.popupSave.txtLayoutName.focus(),200)});eU.objEdit.popupSave.txtLayoutName.keypress(function(fM){var fN=fM.which,fO=$(this).val().trim();if(fN!==13)return!0;if(!fO)return!0;fM.preventDefault();eU.objEdit.popupSave.btnOk.trigger('click')});eU.objEdit.popupSave.btnCancel.click(()=>eY.webuiPopover('hide'));eU.objEdit.popupSave.btnOk.click(()=>{var fP=eU.objEdit.popupSave.txtLayoutName.val().trim(),fQ=eU.objEdit.ddlLayoutEdit[0].selectedIndex;if(!fP)return;eU.objEdit.layoutsEdit[fQ].title=fP;eU.objEdit.ddlLayoutEdit.find('option').eq(fQ).text(fP);dV?dV(eU.objEdit.layoutsEdit[fQ],fR=>{eU.objEdit.layoutsEdit[fQ].id=fR;eU.objEdit.ddlLayoutEdit.trigger('change');eY.webuiPopover('hide')}):eU.objEdit.layoutsEdit[fQ].id=j()});eU.objEdit.btnDefault.click(()=>{var fS=eU.objEdit.ddlLayoutEdit[0].selectedIndex;dW&&dW(eU.objEdit.layoutsEdit[fS])});eU.objEdit.btnCopy.click(async ()=>{var fT=eU.objEdit.ddlLayoutEdit[0].selectedIndex;try {await navigator.clipboard.writeText(JSON.stringify(eU.objEdit.layoutsEdit[fT].columns));dX&&A(dX)&&dX(eU.objEdit.layoutsEdit[fT])} catch {console.error('Copy not support')}})};_r.prototype.showPopupEdit=function(){var fU=this;fU.objEdit.popupEdit?.css('display','block');fU.objEdit.layoutsEdit=JSON.parse(JSON.stringify(fU.layouts));fU.objEdit.ddlLayoutEdit.empty();for(const fV of fU.objEdit.layoutsEdit)fU.objEdit.ddlLayoutEdit.append(`<option value="${fV.id}">${fV.title}</option>`);fU.objEdit.ddlLayoutEdit.val(fU.ddl.val());fU.objEdit.ddlLayoutEdit.trigger('change');fU.objEdit.tablePreview.setData(fU.data);fU.objEdit.tablePreview.reload()};return new _r()}})(jQuery);
